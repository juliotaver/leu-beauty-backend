üîÑ Iniciando actualizaci√≥n para cliente: mV9PYJOfRM05oeThA1HB
üìÑ Datos del cliente: {
  "recompensasCanjeadas": [],
  "nombre": "jorge camacho",
  "email": "jorget@test.com",
  "telefono": "",
  "proximaRecompensa": "Postre Gratis",
  "fechaRegistro": {
    "_seconds": 1731379565,
    "_nanoseconds": 869000000
  },
  "ultimaVisita": {
    "_seconds": 1731379801,
    "_nanoseconds": 238000000
  },
  "lastPassUpdate": {
    "_seconds": 1731379801,
    "_nanoseconds": 238000000
  },
  "visitas": 1
}
üîç Token no encontrado en cliente, buscando en registros...
‚ùå Error en sendUpdateNotification: Error: 9 FAILED_PRECONDITION: The query requires an index. You can create it here: https://console.firebase.google.com/v1/r/project/leu-beauty-loyalty/firestore/indexes?create_composite=Cl5wcm9qZWN0cy9sZXUtYmVhdXR5LWxveWFsdHkvZGF0YWJhc2VzLyhkZWZhdWx0KS9jb2xsZWN0aW9uR3JvdXBzL2RldmljZVJlZ2lzdHJhdGlvbnMvaW5kZXhlcy9fEAEaEAoMc2VyaWFsTnVtYmVyEAEaDwoLbGFzdFVwZGF0ZWQQAhoMCghfX25hbWVfXxAC
    at callErrorFromStatus (/opt/render/project/src/node_modules/google-gax/node_modules/@grpc/grpc-js/build/src/call.js:31:19)
    at Object.onReceiveStatus (/opt/render/project/src/node_modules/google-gax/node_modules/@grpc/grpc-js/build/src/client.js:357:73)
    at Object.onReceiveStatus (/opt/render/project/src/node_modules/google-gax/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:323:181)
    at /opt/render/project/src/node_modules/google-gax/node_modules/@grpc/grpc-js/build/src/resolving-call.js:94:78
    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)
for call at
    at ServiceClientImpl.makeServerStreamRequest (/opt/render/project/src/node_modules/google-gax/node_modules/@grpc/grpc-js/build/src/client.js:340:32)
    at ServiceClientImpl.<anonymous> (/opt/render/project/src/node_modules/google-gax/node_modules/@grpc/grpc-js/build/src/make-client.js:105:19)
    at /opt/render/project/src/node_modules/@google-cloud/firestore/build/src/v1/firestore_client.js:227:29
    at /opt/render/project/src/node_modules/google-gax/build/src/streamingCalls/streamingApiCaller.js:38:28
    at /opt/render/project/src/node_modules/google-gax/build/src/normalCalls/timeout.js:44:16
    at Object.request (/opt/render/project/src/node_modules/google-gax/build/src/streamingCalls/streaming.js:130:40)
    at makeRequest (/opt/render/project/src/node_modules/retry-request/index.js:141:28)
    at retryRequest (/opt/render/project/src/node_modules/retry-request/index.js:109:5)
    at StreamProxy.setStream (/opt/render/project/src/node_modules/google-gax/build/src/streamingCalls/streaming.js:121:37)
    at StreamingApiCaller.call (/opt/render/project/src/node_modules/google-gax/build/src/streamingCalls/streamingApiCaller.js:54:16)
Caused by: Error
    at Query._get (/opt/render/project/src/node_modules/@google-cloud/firestore/build/src/reference.js:1738:23)
    at Query.get (/opt/render/project/src/node_modules/@google-cloud/firestore/build/src/reference.js:1726:21)
    at PushNotificationService.<anonymous> (/opt/render/project/src/dist/services/pushNotificationService.js:49:26)
    at Generator.next (<anonymous>)
    at fulfilled (/opt/render/project/src/dist/services/pushNotificationService.js:5:58)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5) {
  code: 9,
  details: 'The query requires an index. You can create it here: https://console.firebase.google.com/v1/r/project/leu-beauty-loyalty/firestore/indexes?create_composite=Cl5wcm9qZWN0cy9sZXUtYmVhdXR5LWxveWFsdHkvZGF0YWJhc2VzLyhkZWZhdWx0KS9jb2xsZWN0aW9uR3JvdXBzL2RldmljZVJlZ2lzdHJhdGlvbnMvaW5kZXhlcy9fEAEaEAoMc2VyaWFsTnVtYmVyEAEaDwoLbGFzdFVwZGF0ZWQQAhoMCghfX25hbWVfXxAC',
  metadata: Metadata {
    internalRepr: Map(1) { 'x-debug-tracking-id' => [Array] },
    options: {}
  }
}
Error details: {
  message: '9 FAILED_PRECONDITION: The query requires an index. You can create it here: https://console.firebase.google.com/v1/r/project/leu-beauty-loyalty/firestore/indexes?create_composite=Cl5wcm9qZWN0cy9sZXUtYmVhdXR5LWxveWFsdHkvZGF0YWJhc2VzLyhkZWZhdWx0KS9jb2xsZWN0aW9uR3JvdXBzL2RldmljZVJlZ2lzdHJhdGlvbnMvaW5kZXhlcy9fEAEaEAoMc2VyaWFsTnVtYmVyEAEaDwoLbGFzdFVwZGF0ZWQQAhoMCghfX25hbWVfXxAC',
  stack: 'Error: 9 FAILED_PRECONDITION: The query requires an index. You can create it here: https://console.firebase.google.com/v1/r/project/leu-beauty-loyalty/firestore/indexes?create_composite=Cl5wcm9qZWN0cy9sZXUtYmVhdXR5LWxveWFsdHkvZGF0YWJhc2VzLyhkZWZhdWx0KS9jb2xsZWN0aW9uR3JvdXBzL2RldmljZVJlZ2lzdHJhdGlvbnMvaW5kZXhlcy9fEAEaEAoMc2VyaWFsTnVtYmVyEAEaDwoLbGFzdFVwZGF0ZWQQAhoMCghfX25hbWVfXxAC\n' +
    '    at callErrorFromStatus (/opt/render/project/src/node_modules/google-gax/node_modules/@grpc/grpc-js/build/src/call.js:31:19)\n' +
    '    at Object.onReceiveStatus (/opt/render/project/src/node_modules/google-gax/node_modules/@grpc/grpc-js/build/src/client.js:357:73)\n' +
    '    at Object.onReceiveStatus (/opt/render/project/src/node_modules/google-gax/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:323:181)\n' +
    '    at /opt/render/project/src/node_modules/google-gax/node_modules/@grpc/grpc-js/build/src/resolving-call.js:94:78\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)\n' +
    'for call at\n' +
    '    at ServiceClientImpl.makeServerStreamRequest (/opt/render/project/src/node_modules/google-gax/node_modules/@grpc/grpc-js/build/src/client.js:340:32)\n' +
    '    at ServiceClientImpl.<anonymous> (/opt/render/project/src/node_modules/google-gax/node_modules/@grpc/grpc-js/build/src/make-client.js:105:19)\n' +
    '    at /opt/render/project/src/node_modules/@google-cloud/firestore/build/src/v1/firestore_client.js:227:29\n' +
    '    at /opt/render/project/src/node_modules/google-gax/build/src/streamingCalls/streamingApiCaller.js:38:28\n' +
    '    at /opt/render/project/src/node_modules/google-gax/build/src/normalCalls/timeout.js:44:16\n' +
    '    at Object.request (/opt/render/project/src/node_modules/google-gax/build/src/streamingCalls/streaming.js:130:40)\n' +
    '    at makeRequest (/opt/render/project/src/node_modules/retry-request/index.js:141:28)\n' +
    '    at retryRequest (/opt/render/project/src/node_modules/retry-request/index.js:109:5)\n' +
    '    at StreamProxy.setStream (/opt/render/project/src/node_modules/google-gax/build/src/streamingCalls/streaming.js:121:37)\n' +
    '    at StreamingApiCaller.call (/opt/render/project/src/node_modules/google-gax/build/src/streamingCalls/streamingApiCaller.js:54:16)\n' +
    'Caused by: Error\n' +
    '    at Query._get (/opt/render/project/src/node_modules/@google-cloud/firestore/build/src/reference.js:1738:23)\n' +
    '    at Query.get (/opt/render/project/src/node_modules/@google-cloud/firestore/build/src/reference.js:1726:21)\n' +
    '    at PushNotificationService.<anonymous> (/opt/render/project/src/dist/services/pushNotificationService.js:49:26)\n' +
    '    at Generator.next (<anonymous>)\n' +
    '    at fulfilled (/opt/render/project/src/dist/services/pushNotificationService.js:5:58)\n' +
    '    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)'
}
Error: Error: 9 FAILED_PRECONDITION: The query requires an index. You can create it here: https://console.firebase.google.com/v1/r/project/leu-beauty-loyalty/firestore/indexes?create_composite=Cl5wcm9qZWN0cy9sZXUtYmVhdXR5LWxveWFsdHkvZGF0YWJhc2VzLyhkZWZhdWx0KS9jb2xsZWN0aW9uR3JvdXBzL2RldmljZVJlZ2lzdHJhdGlvbnMvaW5kZXhlcy9fEAEaEAoMc2VyaWFsTnVtYmVyEAEaDwoLbGFzdFVwZGF0ZWQQAhoMCghfX25hbWVfXxAC
    at callErrorFromStatus (/opt/render/project/src/node_modules/google-gax/node_modules/@grpc/grpc-js/build/src/call.js:31:19)
    at Object.onReceiveStatus (/opt/render/project/src/node_modules/google-gax/node_modules/@grpc/grpc-js/build/src/client.js:357:73)
    at Object.onReceiveStatus (/opt/render/project/src/node_modules/google-gax/node_modules/@grpc/grpc-js/build/src/client-interceptors.js:323:181)
    at /opt/render/project/src/node_modules/google-gax/node_modules/@grpc/grpc-js/build/src/resolving-call.js:94:78
    at process.processTicksAndRejections (node:internal/process/task_queues:77:11)
for call at
    at ServiceClientImpl.makeServerStreamRequest (/opt/render/project/src/node_modules/google-gax/node_modules/@grpc/grpc-js/build/src/client.js:340:32)
    at ServiceClientImpl.<anonymous> (/opt/render/project/src/node_modules/google-gax/node_modules/@grpc/grpc-js/build/src/make-client.js:105:19)
    at /opt/render/project/src/node_modules/@google-cloud/firestore/build/src/v1/firestore_client.js:227:29
    at /opt/render/project/src/node_modules/google-gax/build/src/streamingCalls/streamingApiCaller.js:38:28
    at /opt/render/project/src/node_modules/google-gax/build/src/normalCalls/timeout.js:44:16
    at Object.request (/opt/render/project/src/node_modules/google-gax/build/src/streamingCalls/streaming.js:130:40)
    at makeRequest (/opt/render/project/src/node_modules/retry-request/index.js:141:28)
    at retryRequest (/opt/render/project/src/node_modules/retry-request/index.js:109:5)
    at StreamProxy.setStream (/opt/render/project/src/node_modules/google-gax/build/src/streamingCalls/streaming.js:121:37)
    at StreamingApiCaller.call (/opt/render/project/src/node_modules/google-gax/build/src/streamingCalls/streamingApiCaller.js:54:16)
Caused by: Error
    at Query._get (/opt/render/project/src/node_modules/@google-cloud/firestore/build/src/reference.js:1738:23)
    at Query.get (/opt/render/project/src/node_modules/@google-cloud/firestore/build/src/reference.js:1726:21)
    at PushNotificationService.<anonymous> (/opt/render/project/src/dist/services/pushNotificationService.js:49:26)
    at Generator.next (<anonymous>)
    at fulfilled (/opt/render/project/src/dist/services/pushNotificationService.js:5:58)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5) {
  code: 9,
  details: 'The query requires an index. You can create it here: https://console.firebase.google.com/v1/r/project/leu-beauty-loyalty/firestore/indexes?create_composite=Cl5wcm9qZWN0cy9sZXUtYmVhdXR5LWxveWFsdHkvZGF0YWJhc2VzLyhkZWZhdWx0KS9jb2xsZWN0aW9uR3JvdXBzL2RldmljZVJlZ2lzdHJhdGlvbnMvaW5kZXhlcy9fEAEaEAoMc2VyaWFsTnVtYmVyEAEaDwoLbGFzdFVwZGF0ZWQQAhoMCghfX25hbWVfXxAC',
  metadata: Metadata {
    internalRepr: Map(1) { 'x-debug-tracking-id' => [Array] },
    options: {}
  }
}
üì§ Respuesta [500]: {"error":"Error interno","details":"9 FAILED_PRECONDITION: The query requires an index. You can create it here: https://console.firebase.google.com/v1/r/project/leu-beauty-loyalty/firestore/indexes?create_composite=Cl5wcm9qZWN0cy9sZXUtYmVhdXR5LWxveWFsdHkvZGF0YWJhc2VzLyhkZWZhdWx0KS9jb2xsZWN0aW9uR3JvdXBzL2RldmljZVJlZ2lzdHJhdGlvbnMvaW5kZXhlcy9fEAEaEAoMc2VyaWFsTnVtYmVyEAEaDwoLbGFzdFVwZGF0ZWQQAhoMCghfX25hbWVfXxAC"}